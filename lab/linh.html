  <html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>ArcGIS JavaScript Tutorials: Create a Starter App</title>
    <style>
      html, body, #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

      <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.26/"></script>

    <script>
    var point_template_tree = {
            title: "{Name}",
            content: "Cây này ở <b>{Location}</b>."
          };
    var point_template_light = {
            title: "{Name}",
            content: "Bóng đèn này ở <b>{Location}</b>."
          };
    var point_template_chair = {
            title: "{Name}",
            content: "Cái ghế này ở <b>{Location}</b>."
          };
    var point_template_area = {
            title: "{Name}",
            content: "Khu vực này ở <b>{Location}</b>."
          };
    var point_template_university = {
            title: "{Name}",
            content: "Trường ở <b>{Location}</b>."
          };
    var jsondata = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Đường ranh giới",
        "description": "Đường ranh giới khu vực Công viên Hoàng Văn Thụ"
      },
      "geometry": {
        "coordinates": [
        [
            106.663601,
            10.80245
        ],
        [
            106.663559,
            10.802438
        ],
        [
            106.663506,
            10.802387
        ],
        [
            106.663455,
            10.802323
        ],
        [
            106.663393,
            10.802251
        ],
        [
            106.663314,
            10.802158
        ],
        [
            106.66326,
            10.802095
        ],
        [
            106.663237,
            10.802069
        ],
        [
            106.663196,
            10.802021
        ],
        [
            106.663156,
            10.801974
        ],
        [
            106.663116,
            10.80193
        ],
        [
            106.66308,
            10.801904
        ],
        [
            106.663038,
            10.801864
        ],
        [
            106.662783,
            10.801618
        ],
        [
            106.662518,
            10.801363
        ],
        [
            106.66227,
            10.801094
        ],
        [
            106.662316,
            10.800934
        ],
        [
            106.662359,
            10.800779
        ],
        [
            106.662535,
            10.800762
        ],
        [
            106.662905,
            10.80073
        ],
        [
            106.663125,
            10.800711
        ],
        [
            106.663405,
            10.800686
        ],
        [
            106.6638,
            10.800653
        ],
        [
            106.664241,
            10.800614
        ],
        [
            106.664697,
            10.800574
        ],
        [
            106.665041,
            10.800544
        ],
        [
            106.66536,
            10.800516
        ],
        [
            106.665781,
            10.800479
        ],
        [
            106.666236,
            10.800438
        ],
        [
            106.666433,
            10.800421
        ],
        [
            106.666917,
            10.800378
        ],
        [
            106.666943,
            10.800487
        ],
        [
            106.666848,
            10.800552
        ],
        [
            106.666602,
            10.80072
        ],
        [
            106.666171,
            10.801017
        ],
        [
            106.665946,
            10.801166
        ],
        [
            106.665686,
            10.801301
        ],
        [
            106.665698,
            10.801325
        ],
        [
            106.66566,
            10.801546
        ],
        [
            106.665675,
            10.801553
        ],
        [
            106.66568,
            10.801565
        ],
        [
            106.665685,
            10.801579
        ],
        [
            106.665647,
            10.801627
        ],
        [
            106.665592,
            10.801695
        ],
        [
            106.665554,
            10.801742
        ],
        [
            106.665506,
            10.801809
        ],
        [
            106.665442,
            10.801903
        ],
        [
            106.665372,
            10.802006
        ],
        [
            106.665276,
            10.802169
        ],
        [
            106.665291,
            10.802178
        ],
        [
            106.665279,
            10.802206
        ],
        [
            106.665263,
            10.802197
        ],
        [
            106.665245,
            10.802233
        ],
        [
            106.665216,
            10.802289
        ],
        [
            106.665182,
            10.802355
        ],
        [
            106.665157,
            10.802403
        ],
        [
            106.665136,
            10.802451
        ],
        [
            106.665107,
            10.802513
        ],
        [
            106.665082,
            10.802567
        ],
        [
            106.665064,
            10.802608
        ],
        [
            106.665054,
            10.80263
        ],
        [
            106.665036,
            10.802677
        ],
        [
            106.665008,
            10.802751
        ],
        [
            106.664986,
            10.802811
        ],
        [
            106.664959,
            10.80288
        ],
        [
            106.664937,
            10.802941
        ],
        [
            106.664922,
            10.802989
        ],
        [
            106.6649,
            10.803059
        ],
        [
            106.664881,
            10.803122
        ],
        [
            106.664862,
            10.803185
        ],
        [
            106.664834,
            10.803292
        ],
        [
            106.664808,
            10.803391
        ],
        [
            106.664795,
            10.803439
        ],
        [
            106.66478,
            10.803505
        ],
        [
            106.664764,
            10.803579
        ],
        [
            106.664545,
            10.804561
        ],
        [
            106.664368,
            10.804556
        ],
        [
            106.66431,
            10.804234
        ],
        [
            106.664292,
            10.80418
        ],
        [
            106.664265,
            10.804089
        ],
        [
            106.664245,
            10.804023
        ],
        [
            106.664224,
            10.803952
        ],
        [
            106.664196,
            10.803859
        ],
        [
            106.664167,
            10.803759
        ],
        [
            106.664146,
            10.803689
        ],
        [
            106.66411,
            10.803592
        ],
        [
            106.664075,
            10.803502
        ],
        [
            106.664034,
            10.803402
        ],
        [
            106.663748,
            10.802795
        ],
        [
            106.663743,
            10.802757
        ],
        [
            106.663768,
            10.802717
        ],
        [
            106.663788,
            10.802686
        ],
        [
            106.663812,
            10.802655
        ]
        ],
        "type": "LineString"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Công viên Hoàng Văn Thụ",
        "address": "Phường 2, Tân Bình, Hồ Chí Minh, Việt Nam",
        "type": "Stadium",
        "established": "1931",
        "area": "Khu vực thể thao, sự kiện"
      },
      "geometry": {
        "type": "Polygon",
        "symbol": {
          "type": "simple-fill",
          "color": [227, 139, 79, 0.4],
          "outline": {
            "color": [255, 255, 255],
            "width": 1
          }
        },
        "coordinates": [
         [
            [
              106.66450382977877,
              10.801941174117225
            ],
            [
              106.66449394186532,
              10.801940696962294
            ],
            [
              106.66448414917795,
              10.801939270092767
            ],
            [
              106.66447454602573,
              10.80193690725019
            ],
            [
              106.66446522489234,
              10.801933631190055
            ],
            [
              106.6644562755454,
              10.801929473462637
            ],
            [
              106.66444778417218,
              10.80192447410916
            ],
            [
              106.6644398325492,
              10.80191868127617
            ],
            [
              106.66443249725499,
              10.801912150751866
            ],
            [
              106.66442584893247,
              10.80190494542881
            ],
            [
              106.6644199516086,
              10.80189713469824
            ],
            [
              106.66441486207779,
              10.801888793781815
            ],
            [
              106.66441062935499,
              10.801880003007161
            ],
            [
              106.66440729420357,
              10.801870847034271
            ],
            [
              106.66440488874275,
              10.801861414040205
            ],
            [
              106.66440343613837,
              10.80185179486987
            ],
            [
              106.66440295037974,
              10.801842082161151
            ],
            [
              106.66440343614488,
              10.801832369452747
            ],
            [
              106.6644048887555,
              10.801822750283343
            ],
            [
              106.66440729422204,
              10.801813317290788
            ],
            [
              106.66441062937854,
              10.801804161319932
            ],
            [
              106.66441486210547,
              10.801795370547753
            ],
            [
              106.66441995163935,
              10.801787029634156
            ],
            [
              106.66442584896514,
              10.801779218906654
            ],
            [
              106.66443249728829,
              10.801772013586787
            ],
            [
              106.66443983258185,
              10.80176548306567
            ],
            [
              106.66444778420293,
              10.80175969023575
            ],
            [
              106.66445627557309,
              10.801754690885097
            ],
            [
              106.66446522491587,
              10.801750533160156
            ],
            [
              106.66447454604423,
              10.801747257102054
            ],
            [
              106.66448414919071,
              10.801744894260988
            ],
            [
              106.66449394187181,
              10.801743467392393
            ],
            [
              106.66450382977877,
              10.801742990237775
            ],
            [
              106.66451371768572,
              10.801743467392393
            ],
            [
              106.66452351036683,
              10.801744894260988
            ],
            [
              106.6645331135133,
              10.801747257102054
            ],
            [
              106.66454243464166,
              10.801750533160156
            ],
            [
              106.66455138398445,
              10.801754690885097
            ],
            [
              106.6645598753546,
              10.80175969023575
            ],
            [
              106.66456782697568,
              10.80176548306567
            ],
            [
              106.66457516226924,
              10.801772013586787
            ],
            [
              106.6645818105924,
              10.801779218906654
            ],
            [
              106.66458770791819,
              10.801787029634156
            ],
            [
              106.66459279745206,
              10.801795370547753
            ],
            [
              106.664597030179,
              10.801804161319932
            ],
            [
              106.66460036533549,
              10.801813317290788
            ],
            [
              106.66460277080203,
              10.801822750283343
            ],
            [
              106.66460422341264,
              10.801832369452747
            ],
            [
              106.6646047091778,
              10.801842082161151
            ],
            [
              106.66460422341916,
              10.80185179486987
            ],
            [
              106.66460277081478,
              10.801861414040205
            ],
            [
              106.66460036535396,
              10.801870847034271
            ],
            [
              106.66459703020254,
              10.801880003007161
            ],
            [
              106.66459279747974,
              10.801888793781815
            ],
            [
              106.66458770794893,
              10.80189713469824
            ],
            [
              106.66458181062507,
              10.80190494542881
            ],
            [
              106.66457516230254,
              10.801912150751866
            ],
            [
              106.66456782700833,
              10.80191868127617
            ],
            [
              106.66455987538536,
              10.80192447410916
            ],
            [
              106.66455138401213,
              10.801929473462637
            ],
            [
              106.66454243466521,
              10.801933631190055
            ],
            [
              106.66453311353179,
              10.80193690725019
            ],
            [
              106.66452351037958,
              10.801939270092767
            ],
            [
              106.66451371769222,
              10.801940696962294
            ],
            [
              106.66450382977877,
              10.801941174117225
            ]
          ] ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Công viên Hoàng Văn Thụ",
        "type": "Điểm trung tâm",
        "description": "Vị trí trung tâm của khu vực Công viên Hoàng Văn Thụ"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [106.6645040735894,
          10.801840771323626]
      }
    }

  ]
};
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/Graphic",
        "esri/layers/GraphicsLayer"
      ], function(Map, MapView, Graphic, GraphicsLayer) {

      var map = new Map({
      basemap: "topo-vector"
      });
      map.on("load", function(){
            map.graphics.enableMouseEvents();
          });

      var view = new MapView({
      container: "viewDiv",
      map: map,
      center: [106.6645040735894,
          10.801840771323626],
      zoom: 17,
            highlightOptions: {
              color: "blue"
            }
      });
      var graphicsLayer = new GraphicsLayer();

      var lineSymbol = {
        type: "simple-line",
        color: [255, 87, 34],
        width: 3,
        style: "solid"
      };

      var polygonSymbol = {
        type: "simple-fill",
        color: [33, 150, 243, 0.6],
        outline: {
          color: [21, 101, 192],
          width: 2
        }
      };

      var pointSymbol = {
        type: "picture-marker",
        url: "https://cdn-icons-png.flaticon.com/512/532/532988.png",
        width: "56px",
        height: "56px"
      };

      jsondata.features.forEach(function(feature) {
        var geometry;
        var symbol;
        var popupTemplate;

        if (feature.geometry.type === "LineString") {
          geometry = {
            type: "polyline",
            paths: [feature.geometry.coordinates]
          };
          symbol = lineSymbol;
          popupTemplate = {
            title: feature.properties.name,
            content: "<b>Mô tả:</b> {description}<br/><b>Loại:</b> Đường ranh giới"
          };

          var lineGraphic = new Graphic({
            geometry: geometry,
            symbol: symbol,
            attributes: feature.properties,
            popupTemplate: popupTemplate
          });
          graphicsLayer.add(lineGraphic);

          var polygonGeometry = {
            type: "polygon",
            rings: [feature.geometry.coordinates]
          };

          var polygonFill = {
            type: "simple-fill",
            color: [255, 193, 7, 0.4],
            outline: {
              color: [255, 152, 0],
              width: 2
            }
          };

          var polygonGraphic = new Graphic({
            geometry: polygonGeometry,
            symbol: polygonFill,
            attributes: { name: feature.properties.name + " (fill)" },
            popupTemplate: {
              title: feature.properties.name,
              content: "Đây là vùng được fill từ đường ranh giới."
            }
          });

          graphicsLayer.add(polygonGraphic);

          return;
        } else if (feature.geometry.type === "Polygon") {
          geometry = {
            type: "polygon",
            rings: feature.geometry.coordinates
          };
          symbol = polygonSymbol;
          popupTemplate = {
            title: feature.properties.name,
            content: `
              <div style="font-family: Arial, sans-serif;">
                <p><b>📍 Địa chỉ:</b> {address}</p>
                <p><b>🏛️ Loại:</b> {type}</p>
                <p><b>📅 Thành lập:</b> {established}</p>
                <p><b>🗺️ Khu vực:</b> {area}</p>
                <p><b>ℹ️ Mô tả:</b> Trụ sở chính của chính quyền thành phố</p>
              </div>
            `
          };
        } else if (feature.geometry.type === "Point") {
          geometry = {
            type: "point",
            longitude: feature.geometry.coordinates[0],
            latitude: feature.geometry.coordinates[1]
          };
          symbol = pointSymbol;
          popupTemplate = {
            title: feature.properties.name,
            content: `
              <div style="font-family: Arial, sans-serif; text-align: center;">
                <p><b>📍 {type}</b></p>
                <p>{description}</p>
                <p style="color: #1976D2;"><b>Tọa độ:</b><br/>
                Kinh độ: ${feature.geometry.coordinates[0].toFixed(6)}<br/>
                Vĩ độ: ${feature.geometry.coordinates[1].toFixed(6)}</p>
              </div>
            `
          };
        }

        var graphic = new Graphic({
          geometry: geometry,
          symbol: symbol,
          attributes: feature.properties,
          popupTemplate: popupTemplate
        });
        graphicsLayer.add(graphic);
      });

      // Khai báo mảng để lưu trữ các tọa độ được click
var clickedCoordinates = [];
var clickedGraphics = []; // Để lưu trữ các graphic điểm đã click

// --- Thêm layer riêng cho các điểm click vào bản đồ ---
// Đảm bảo rằng biến 'map' đã được khởi tạo trước khi gọi dòng này
// Nếu bạn đã có map.add(graphicsLayer); thì hãy thêm dòng này sau đó.
var clickGraphicsLayer; // Khai báo biến layer ở đây
require([
    "esri/Graphic",
    "esri/layers/GraphicsLayer"
], function(Graphic, GraphicsLayer) {
    clickGraphicsLayer = new GraphicsLayer(); // Khởi tạo GraphicsLayer
    map.add(clickGraphicsLayer); // Thêm layer riêng cho các điểm click vào bản đồ

    // --- Xử lý sự kiện click trên bản đồ ---
    // Đảm bảo rằng biến 'view' đã được khởi tạo trước khi gọi dòng này
    view.on("click", function(event) {
        var latitude = parseFloat(event.mapPoint.latitude.toFixed(6));
        var longitude = parseFloat(event.mapPoint.longitude.toFixed(6));
        var newCoordinate = [longitude, latitude]; // Định dạng [kinh độ, vĩ độ]

        clickedCoordinates.push(newCoordinate); // Thêm tọa độ vào mảng

        // Tạo graphic cho điểm mới click
        var pointGraphic = new Graphic({
            geometry: {
                type: "point",
                longitude: longitude,
                latitude: latitude
            },
            symbol: {
                type: "simple-marker",
                color: [0, 150, 136], // Màu xanh ngọc
                size: 8,
                outline: {
                    color: [255, 255, 255],
                    width: 1
                }
            },
            popupTemplate: {
                title: "Điểm đã chọn",
                content: `Vĩ độ: ${latitude.toFixed(6)}<br>Kinh độ: ${longitude.toFixed(6)}`
            }
        });
        clickGraphicsLayer.add(pointGraphic); // Thêm vào layer riêng
        clickedGraphics.push(pointGraphic); // Lưu graphic để có thể xóa sau

        updateCoordinateOutput(); // Cập nhật hiển thị JSON
    });

    // Hàm để cập nhật nội dung hiển thị JSON (và log ra console)
    function updateCoordinateOutput() {
        var jsonString = JSON.stringify(clickedCoordinates, null, 2); // Định dạng JSON đẹp hơn

        // Log ra console
        console.log("Current Coordinates (JSON):");
        console.log(jsonString);

        // Cập nhật hiển thị trên trang HTML (nếu có div output)
        var outputDiv = document.getElementById("coordinateOutput");
        if (outputDiv) {
            outputDiv.textContent = jsonString;
        } else {
            console.warn("Element with id 'coordinateOutput' not found. Coordinates will only be logged to console.");
        }
    }
// --- Nút để xóa tất cả các điểm đã click và mảng tọa độ ---
    var clearButton = document.getElementById("clearButton");
    if (clearButton) { // Kiểm tra xem nút có tồn tại không
        clearButton.addEventListener("click", function() {
            clickedCoordinates = []; // Xóa mảng tọa độ
            clickGraphicsLayer.removeAll(); // Xóa tất cả graphic trên layer click
            clickedGraphics = []; // Xóa mảng graphic đã lưu
            updateCoordinateOutput(); // Cập nhật lại hiển thị (sẽ log mảng rỗng)
        });
    } else {
        console.warn("Element with id 'clearButton' not found. Clear functionality will not be available.");
    }
});
      map.add(graphicsLayer);


      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
  </body>
  </html>
