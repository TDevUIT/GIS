<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>ArcGIS JavaScript Tutorials: Create a Starter App</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.26/"></script>

    <script>
        var point_template_tree = {
            title: "{Name}",
            content: "C√¢y n√†y ·ªü <b>{Location}</b>."
        };
        var point_template_light = {
            title: "{Name}",
            content: "B√≥ng ƒë√®n n√†y ·ªü <b>{Location}</b>."
        };
        var point_template_chair = {
            title: "{Name}",
            content: "C√°i gh·∫ø n√†y ·ªü <b>{Location}</b>."
        };
        var point_template_area = {
            title: "{Name}",
            content: "Khu v·ª±c n√†y ·ªü <b>{Location}</b>."
        };
        var point_template_university = {
            title: "{Name}",
            content: "Tr∆∞·ªùng ·ªü <b>{Location}</b>."
        };
        var jsondata = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "ƒê∆∞·ªùng ranh gi·ªõi",
                        "description": "ƒê∆∞·ªùng ranh gi·ªõi s√¢n golf T√¢n S∆°n Nh·∫•t"
                    },
                    "geometry": {
                        "coordinates": [
                            [
                                106.646653,
                                10.836675
                            ],
                            [
                                106.649122,
                                10.836615
                            ],
                            [
                                106.649212,
                                10.836613
                            ],
                            [
                                106.651082,
                                10.836568
                            ],
                            [
                                106.651141,
                                10.836542
                            ],
                            [
                                106.651573,
                                10.836446
                            ],
                            [
                                106.652006,
                                10.836545
                            ],
                            [
                                106.652494,
                                10.836533
                            ],
                            [
                                106.652656,
                                10.833656
                            ],
                            [
                                106.652464,
                                10.831005
                            ],
                            [
                                106.653026,
                                10.831051
                            ],
                            [
                                106.655712,
                                10.831636
                            ],
                            [
                                106.655796,
                                10.831644
                            ],
                            [
                                106.656308,
                                10.831651
                            ],
                            [
                                106.65705,
                                10.831616
                            ],
                            [
                                106.657035,
                                10.83141
                            ],
                            [
                                106.657026,
                                10.831276
                            ],
                            [
                                106.65702,
                                10.831199
                            ],
                            [
                                106.657005,
                                10.830995
                            ],
                            [
                                106.65688,
                                10.829768
                            ],
                            [
                                106.656538,
                                10.826282
                            ],
                            [
                                106.656516,
                                10.826242
                            ],
                            [
                                106.656472,
                                10.826196
                            ],
                            [
                                106.656403,
                                10.826164
                            ],
                            [
                                106.656159,
                                10.826079
                            ],
                            [
                                106.64751,
                                10.822763
                            ],
                            [
                                106.64724,
                                10.822661
                            ],
                            [
                                106.647181,
                                10.822643
                            ],
                            [
                                106.647129,
                                10.822638
                            ],
                            [
                                106.647056,
                                10.822651
                            ],
                            [
                                106.646914,
                                10.822699
                            ],
                            [
                                106.646635,
                                10.822809
                            ],
                            [
                                106.646128,
                                10.823015
                            ],
                            [
                                106.642651,
                                10.824429
                            ],
                            [
                                106.644544,
                                10.829059
                            ],
                            [
                                106.64742,
                                10.829687
                            ],
                            [
                                106.647536,
                                10.830091
                            ],
                            [
                                106.647623,
                                10.830059
                            ],
                            [
                                106.647711,
                                10.830026
                            ],
                            [
                                106.647839,
                                10.829999
                            ],
                            [
                                106.648,
                                10.829978
                            ],
                            [
                                106.64818,
                                10.829982
                            ],
                            [
                                106.648405,
                                10.830021
                            ],
                            [
                                106.648652,
                                10.830115
                            ],
                            [
                                106.648908,
                                10.830262
                            ],
                            [
                                106.649004,
                                10.830317
                            ],
                            [
                                106.649036,
                                10.830337
                            ],
                            [
                                106.648994,
                                10.830411
                            ],
                            [
                                106.649069,
                                10.830458
                            ],
                            [
                                106.649006,
                                10.830561
                            ],
                            [
                                106.648971,
                                10.830605
                            ],
                            [
                                106.64897,
                                10.830607
                            ],
                            [
                                106.648923,
                                10.830617
                            ],
                            [
                                106.648634,
                                10.830722
                            ],
                            [
                                106.648117,
                                10.831003
                            ],
                            [
                                106.647034,
                                10.831425
                            ],
                            [
                                106.645395,
                                10.83206
                            ],
                            [
                                106.644803,
                                10.832345
                            ],
                            [
                                106.645846,
                                10.834921
                            ]
                        ],
                        "type": "LineString"
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "S√¢n golf T√¢n S∆°n Nh·∫•t",
                        "address": "6 ƒê. T√¢n S∆°n, ph∆∞·ªùng 12, G√≤ V·∫•p, H·ªì Ch√≠ Minh, Vi·ªát Nam",
                        "type": "Stadium",
                        "established": "1956",
                        "area": "Khu v·ª±c th·ªÉ thao, s·ª± ki·ªán"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "symbol": {
                            "type": "simple-fill",
                            "color": [227, 139, 79, 0.4],
                            "outline": {
                                "color": [255, 255, 255],
                                "width": 1
                            }
                        },
                        "coordinates": [
                            [
                                [
                                    106.65104937209657,
                                    10.830761713421875
                                ],
                                [
                                    106.65100745365042,
                                    10.830759690781532
                                ],
                                [
                                    106.65096593890351,
                                    10.830753642339719
                                ],
                                [
                                    106.65092522766716,
                                    10.830743626346472
                                ],
                                [
                                    106.65088571201433,
                                    10.83072973926168
                                ],
                                [
                                    106.65084777250367,
                                    10.830712114826083
                                ],
                                [
                                    106.65081177451447,
                                    10.830690922773277
                                ],
                                [
                                    106.65077806472785,
                                    10.830666367195052
                                ],
                                [
                                    106.65074696778798,
                                    10.830638684575835
                                ],
                                [
                                    106.65071878317553,
                                    10.830608141515217
                                ],
                                [
                                    106.65069378232361,
                                    10.830575032160397
                                ],
                                [
                                    106.65067220600353,
                                    10.830539675373352
                                ],
                                [
                                    106.65065426200631,
                                    10.830502411660005
                                ],
                                [
                                    106.65064012314137,
                                    10.830463599890928
                                ],
                                [
                                    106.65062992557236,
                                    10.830423613845202
                                ],
                                [
                                    106.65062376750599,
                                    10.830382838610698
                                ],
                                [
                                    106.65062170824618,
                                    10.830341666875453
                                ],
                                [
                                    106.650623767623,
                                    10.830300495145872
                                ],
                                [
                                    106.65062992580191,
                                    10.83025971992813
                                ],
                                [
                                    106.6506401234746,
                                    10.830219733909624
                                ],
                                [
                                    106.65065426243045,
                                    10.830180922177181
                                ],
                                [
                                    106.65067220650226,
                                    10.830143658508469
                                ],
                                [
                                    106.65069378287775,
                                    10.83010830177235
                                ],
                                [
                                    106.65071878376382,
                                    10.830075192472787
                                ],
                                [
                                    106.65074696838778,
                                    10.830044649469636
                                ],
                                [
                                    106.65077806531613,
                                    10.830016966907888
                                ],
                                [
                                    106.6508117750686,
                                    10.829992411384918
                                ],
                                [
                                    106.65084777300238,
                                    10.829971219383037
                                ],
                                [
                                    106.65088571243847,
                                    10.829953594992078
                                ],
                                [
                                    106.65092522800042,
                                    10.82993970794392
                                ],
                                [
                                    106.65096593913304,
                                    10.829929691977895
                                ],
                                [
                                    106.65100745376743,
                                    10.82992364355284
                                ],
                                [
                                    106.65104937209657,
                                    10.829921620918158
                                ],
                                [
                                    106.6510912904257,
                                    10.82992364355284
                                ],
                                [
                                    106.6511328050601,
                                    10.829929691977895
                                ],
                                [
                                    106.65117351619274,
                                    10.82993970794392
                                ],
                                [
                                    106.6512130317547,
                                    10.829953594992078
                                ],
                                [
                                    106.65125097119076,
                                    10.829971219383037
                                ],
                                [
                                    106.65128696912453,
                                    10.829992411384918
                                ],
                                [
                                    106.65132067887703,
                                    10.830016966907888
                                ],
                                [
                                    106.65135177580537,
                                    10.830044649469636
                                ],
                                [
                                    106.65137996042932,
                                    10.830075192472787
                                ],
                                [
                                    106.65140496131541,
                                    10.83010830177235
                                ],
                                [
                                    106.65142653769088,
                                    10.830143658508469
                                ],
                                [
                                    106.6514444817627,
                                    10.830180922177181
                                ],
                                [
                                    106.65145862071854,
                                    10.830219733909624
                                ],
                                [
                                    106.65146881839125,
                                    10.83025971992813
                                ],
                                [
                                    106.65147497657014,
                                    10.830300495145872
                                ],
                                [
                                    106.65147703594698,
                                    10.830341666875453
                                ],
                                [
                                    106.65147497668715,
                                    10.830382838610698
                                ],
                                [
                                    106.65146881862077,
                                    10.830423613845202
                                ],
                                [
                                    106.65145862105179,
                                    10.830463599890928
                                ],
                                [
                                    106.65144448218682,
                                    10.830502411660005
                                ],
                                [
                                    106.65142653818961,
                                    10.830539675373352
                                ],
                                [
                                    106.65140496186955,
                                    10.830575032160397
                                ],
                                [
                                    106.65137996101761,
                                    10.830608141515217
                                ],
                                [
                                    106.65135177640518,
                                    10.830638684575835
                                ],
                                [
                                    106.65132067946529,
                                    10.830666367195052
                                ],
                                [
                                    106.65128696967867,
                                    10.830690922773277
                                ],
                                [
                                    106.65125097168948,
                                    10.830712114826083
                                ],
                                [
                                    106.6512130321788,
                                    10.83072973926168
                                ],
                                [
                                    106.65117351652599,
                                    10.830743626346472
                                ],
                                [
                                    106.65113280528962,
                                    10.830753642339719
                                ],
                                [
                                    106.65109129054272,
                                    10.830759690781532
                                ],
                                [
                                    106.65104937209657,
                                    10.830761713421875
                                ]
                            ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "S√¢n golf T√¢n S∆°n Nh·∫•t",
                        "type": "ƒêi·ªÉm trung t√¢m",
                        "description": "V·ªã tr√≠ trung t√¢m c·ªßa khu v·ª±c S√¢n golf TSN"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            106.65109704648569,
                            10.830367214603356
                        ]
                    }
                }

            ]
        };
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Graphic",
            "esri/layers/GraphicsLayer"
        ], function (Map, MapView, Graphic, GraphicsLayer) {

            var map = new Map({
                basemap: "topo-vector"
            });
            map.on("load", function () {
                map.graphics.enableMouseEvents();
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [
                    106.65109704648569,
                    10.830367214603356
                ],
                zoom: 17,
                highlightOptions: {
                    color: "blue"
                }
            });
            var graphicsLayer = new GraphicsLayer();

            var lineSymbol = {
                type: "simple-line",
                color: [255, 87, 34],
                width: 3,
                style: "solid"
            };

            var polygonSymbol = {
                type: "simple-fill",
                color: [33, 150, 243, 0.6],
                outline: {
                    color: [21, 101, 192],
                    width: 2
                }
            };

            var pointSymbol = {
                type: "picture-marker",
                url: "https://cdn-icons-png.flaticon.com/512/2514/2514078.png",
                width: "56px",
                height: "56px"
            };

            jsondata.features.forEach(function (feature) {
                var geometry;
                var symbol;
                var popupTemplate;

                if (feature.geometry.type === "LineString") {
                    geometry = {
                        type: "polyline",
                        paths: [feature.geometry.coordinates]
                    };
                    symbol = lineSymbol;
                    popupTemplate = {
                        title: feature.properties.name,
                        content: "<b>M√¥ t·∫£:</b> {description}<br/><b>Lo·∫°i:</b> ƒê∆∞·ªùng ranh gi·ªõi"
                    };

                    var lineGraphic = new Graphic({
                        geometry: geometry,
                        symbol: symbol,
                        attributes: feature.properties,
                        popupTemplate: popupTemplate
                    });
                    graphicsLayer.add(lineGraphic);

                    var polygonGeometry = {
                        type: "polygon",
                        rings: [feature.geometry.coordinates]
                    };

                    var polygonFill = {
                        type: "simple-fill",
                        color: [255, 193, 7, 0.4],
                        outline: {
                            color: [255, 152, 0],
                            width: 2
                        }
                    };

                    var polygonGraphic = new Graphic({
                        geometry: polygonGeometry,
                        symbol: polygonFill,
                        attributes: { name: feature.properties.name + " (fill)" },
                        popupTemplate: {
                            title: feature.properties.name,
                            content: "ƒê√¢y l√† v√πng ƒë∆∞·ª£c fill t·ª´ ƒë∆∞·ªùng ranh gi·ªõi."
                        }
                    });

                    graphicsLayer.add(polygonGraphic);

                    return;
                } else if (feature.geometry.type === "Polygon") {
                    geometry = {
                        type: "polygon",
                        rings: feature.geometry.coordinates
                    };
                    symbol = polygonSymbol;
                    popupTemplate = {
                        title: feature.properties.name,
                        content: `
              <div style="font-family: Arial, sans-serif;">
                <p><b>üìç ƒê·ªãa ch·ªâ:</b> {address}</p>
                <p><b>üèõÔ∏è Lo·∫°i:</b> {type}</p>
                <p><b>üìÖ Th√†nh l·∫≠p:</b> {established}</p>
                <p><b>üó∫Ô∏è Khu v·ª±c:</b> {area}</p>
                <p><b>‚ÑπÔ∏è M√¥ t·∫£:</b> Tr·ª• s·ªü ch√≠nh c·ªßa ch√≠nh quy·ªÅn th√†nh ph·ªë</p>
              </div>
            `
                    };
                } else if (feature.geometry.type === "Point") {
                    geometry = {
                        type: "point",
                        longitude: feature.geometry.coordinates[0],
                        latitude: feature.geometry.coordinates[1]
                    };
                    symbol = pointSymbol;
                    popupTemplate = {
                        title: feature.properties.name,
                        content: `
              <div style="font-family: Arial, sans-serif; text-align: center;">
                <p><b>üìç {type}</b></p>
                <p>{description}</p>
                <p style="color: #1976D2;"><b>T·ªça ƒë·ªô:</b><br/>
                Kinh ƒë·ªô: ${feature.geometry.coordinates[0].toFixed(6)}<br/>
                Vƒ© ƒë·ªô: ${feature.geometry.coordinates[1].toFixed(6)}</p>
              </div>
            `
                    };
                }

                var graphic = new Graphic({
                    geometry: geometry,
                    symbol: symbol,
                    attributes: feature.properties,
                    popupTemplate: popupTemplate
                });
                graphicsLayer.add(graphic);
            });


            // Khai b√°o m·∫£ng ƒë·ªÉ l∆∞u tr·ªØ c√°c t·ªça ƒë·ªô ƒë∆∞·ª£c click
            var clickedCoordinates = [];
            var clickedGraphics = []; // ƒê·ªÉ l∆∞u tr·ªØ c√°c graphic ƒëi·ªÉm ƒë√£ click

            // --- Th√™m layer ri√™ng cho c√°c ƒëi·ªÉm click v√†o b·∫£n ƒë·ªì ---
            // ƒê·∫£m b·∫£o r·∫±ng bi·∫øn 'map' ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o tr∆∞·ªõc khi g·ªçi d√≤ng n√†y
            // N·∫øu b·∫°n ƒë√£ c√≥ map.add(graphicsLayer); th√¨ h√£y th√™m d√≤ng n√†y sau ƒë√≥.
            var clickGraphicsLayer; // Khai b√°o bi·∫øn layer ·ªü ƒë√¢y
            require([
                "esri/Graphic",
                "esri/layers/GraphicsLayer"
            ], function (Graphic, GraphicsLayer) {
                clickGraphicsLayer = new GraphicsLayer(); // Kh·ªüi t·∫°o GraphicsLayer
                map.add(clickGraphicsLayer); // Th√™m layer ri√™ng cho c√°c ƒëi·ªÉm click v√†o b·∫£n ƒë·ªì

                // --- X·ª≠ l√Ω s·ª± ki·ªán click tr√™n b·∫£n ƒë·ªì ---
                // ƒê·∫£m b·∫£o r·∫±ng bi·∫øn 'view' ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o tr∆∞·ªõc khi g·ªçi d√≤ng n√†y
                view.on("click", function (event) {
                    var latitude = parseFloat(event.mapPoint.latitude.toFixed(6));
                    var longitude = parseFloat(event.mapPoint.longitude.toFixed(6));
                    var newCoordinate = [longitude, latitude]; // ƒê·ªãnh d·∫°ng [kinh ƒë·ªô, vƒ© ƒë·ªô]

                    clickedCoordinates.push(newCoordinate); // Th√™m t·ªça ƒë·ªô v√†o m·∫£ng

                    // T·∫°o graphic cho ƒëi·ªÉm m·ªõi click
                    var pointGraphic = new Graphic({
                        geometry: {
                            type: "point",
                            longitude: longitude,
                            latitude: latitude
                        },
                        symbol: {
                            type: "simple-marker",
                            color: [0, 150, 136], // M√†u xanh ng·ªçc
                            size: 8,
                            outline: {
                                color: [255, 255, 255],
                                width: 1
                            }
                        },
                        popupTemplate: {
                            title: "ƒêi·ªÉm ƒë√£ ch·ªçn",
                            content: `Vƒ© ƒë·ªô: ${latitude.toFixed(6)}<br>Kinh ƒë·ªô: ${longitude.toFixed(6)}`
                        }
                    });
                    clickGraphicsLayer.add(pointGraphic); // Th√™m v√†o layer ri√™ng
                    clickedGraphics.push(pointGraphic); // L∆∞u graphic ƒë·ªÉ c√≥ th·ªÉ x√≥a sau

                    updateCoordinateOutput(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã JSON
                });

                // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t n·ªôi dung hi·ªÉn th·ªã JSON (v√† log ra console)
                function updateCoordinateOutput() {
                    var jsonString = JSON.stringify(clickedCoordinates, null, 2); // ƒê·ªãnh d·∫°ng JSON ƒë·∫πp h∆°n

                    // Log ra console
                    console.log("Current Coordinates (JSON):");
                    console.log(jsonString);

                    // C·∫≠p nh·∫≠t hi·ªÉn th·ªã tr√™n trang HTML (n·∫øu c√≥ div output)
                    var outputDiv = document.getElementById("coordinateOutput");
                    if (outputDiv) {
                        outputDiv.textContent = jsonString;
                    } else {
                        console.warn("Element with id 'coordinateOutput' not found. Coordinates will only be logged to console.");
                    }
                }

                // --- N√∫t ƒë·ªÉ x√≥a t·∫•t c·∫£ c√°c ƒëi·ªÉm ƒë√£ click v√† m·∫£ng t·ªça ƒë·ªô ---
                var clearButton = document.getElementById("clearButton");
                if (clearButton) { // Ki·ªÉm tra xem n√∫t c√≥ t·ªìn t·∫°i kh√¥ng
                    clearButton.addEventListener("click", function () {
                        clickedCoordinates = []; // X√≥a m·∫£ng t·ªça ƒë·ªô
                        clickGraphicsLayer.removeAll(); // X√≥a t·∫•t c·∫£ graphic tr√™n layer click
                        clickedGraphics = []; // X√≥a m·∫£ng graphic ƒë√£ l∆∞u
                        updateCoordinateOutput(); // C·∫≠p nh·∫≠t l·∫°i hi·ªÉn th·ªã (s·∫Ω log m·∫£ng r·ªóng)
                    });
                } else {
                    console.warn("Element with id 'clearButton' not found. Clear functionality will not be available.");
                }
            });

            map.add(graphicsLayer);


        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>
