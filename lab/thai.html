<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ArcGIS JavaScript Tutorials: Create a Starter App</title>
  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.26/"></script>

  <script>
	var point_template_tree = {
					title: "{Name}",
					content: "C√¢y n√†y ·ªü <b>{Location}</b>."
				};
	var point_template_light = {
					title: "{Name}",
					content: "B√≥ng ƒë√®n n√†y ·ªü <b>{Location}</b>."
				};
	var point_template_chair = {
					title: "{Name}",
					content: "C√°i gh·∫ø n√†y ·ªü <b>{Location}</b>."
				};
	var point_template_area = {
					title: "{Name}",
					content: "Khu v·ª±c n√†y ·ªü <b>{Location}</b>."
				};
	var point_template_university = {
					title: "{Name}",
					content: "Tr∆∞·ªùng ·ªü <b>{Location}</b>."
				};
	var jsondata = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "ƒê∆∞·ªùng ranh gi·ªõi B·ªánh Vi·ªán Qu√¢n Y 175",
        "description": "ƒê∆∞·ªùng ranh gi·ªõi khu v·ª±c B·ªánh Vi·ªán Qu√¢n Y 175"
      },
      "geometry": {
        "coordinates": [
        //   [
        //     106.67881736513618,
        //     10.814785583933514
        //   ],
        //   [
        //     106.67889177877368,
        //     10.822201630391959
        //   ],
        //   [
        //     106.68084738065505,
        //     10.822159873418457
        //   ],
        //   [
        //     106.68236722342067,
        //     10.822118116438403
        //   ],
        //   [
        //     106.68261698779139,
        //     10.821737083731847
        //   ],
        //   [
        //     106.68238847996304,
        //     10.82148654141372
        //   ],
        //   [
        //     106.68229813965917,
        //     10.82089150256941
        //   ],
        //   [
        //     106.68185706640776,
        //     10.820813207897245
        //   ],
        //   [
        //     106.68169764239082,
        //     10.818918470458968
        //   ],
        //   [
        //     106.68214257950672,
        //     10.818764795117858
        //   ],
        //   [
        //     106.6789081620837,
        //     10.81468245639816
        //   ],
        //   [
        //     106.67881690240165,
        //     10.814785258184116
        //   ],
        //   [
        //     106.67906299173876,
        //     10.814906790667507
        //   ],
        //   [
        //     106.67882394152758,
        //     10.8148209738509
        //   ]
		[
    106.678877,
    10.822215
  ],
  [
    106.678966,
    10.822209
  ],
  [
    106.679256,
    10.822193
  ],
  [
    106.679274,
    10.822194
  ],
  [
    106.679502,
    10.822204
  ],
  [
    106.679603,
    10.822202
  ],
  [
    106.679704,
    10.822199
  ],
  [
    106.679796,
    10.822198
  ],
  [
    106.67988,
    10.822197
  ],
  [
    106.679935,
    10.822196
  ],
  [
    106.679989,
    10.822194
  ],
  [
    106.68006,
    10.822193
  ],
  [
    106.680139,
    10.822192
  ],
  [
    106.680198,
    10.822191
  ],
  [
    106.680249,
    10.822189
  ],
  [
    106.680295,
    10.822188
  ],
  [
    106.680367,
    10.822185
  ],
  [
    106.680437,
    10.822182
  ],
  [
    106.680503,
    10.822178
  ],
  [
    106.680561,
    10.822175
  ],
  [
    106.680624,
    10.822173
  ],
  [
    106.680703,
    10.822168
  ],
  [
    106.680728,
    10.822168
  ],
  [
    106.680835,
    10.822167
  ],
  [
    106.681019,
    10.822167
  ],
  [
    106.682503,
    10.822164
  ],
  [
    106.682619,
    10.821961
  ],
  [
    106.682828,
    10.821562
  ],
  [
    106.682542,
    10.82155
  ],
  [
    106.68235,
    10.821627
  ],
  [
    106.6823,
    10.821527
  ],
  [
    106.682321,
    10.821296
  ],
  [
    106.682286,
    10.821086
  ],
  [
    106.682321,
    10.820834
  ],
  [
    106.681827,
    10.820812
  ],
  [
    106.681842,
    10.820736
  ],
  [
    106.681836,
    10.81969
  ],
  [
    106.681817,
    10.819501
  ],
  [
    106.681935,
    10.819492
  ],
  [
    106.681929,
    10.819328
  ],
  [
    106.682482,
    10.819309
  ],
  [
    106.682624,
    10.819201
  ],
  [
    106.682406,
    10.818909
  ],
  [
    106.682295,
    10.818762
  ],
  [
    106.682166,
    10.81859
  ],
  [
    106.68183,
    10.818159
  ],
  [
    106.681721,
    10.818022
  ],
  [
    106.681508,
    10.817751
  ],
  [
    106.68131,
    10.817509
  ],
  [
    106.681213,
    10.817389
  ],
  [
    106.68067,
    10.816698
  ],
  [
    106.680497,
    10.816478
  ],
  [
    106.680098,
    10.815972
  ],
  [
    106.68001,
    10.815976
  ],
  [
    106.679772,
    10.815994
  ],
  [
    106.679095,
    10.816045
  ],
  [
    106.679074,
    10.816182
  ],
  [
    106.679075,
    10.816283
  ],
  [
    106.679114,
    10.8163
  ],
  [
    106.679339,
    10.816295
  ],
  [
    106.679387,
    10.816287
  ],
  [
    106.679393,
    10.816594
  ],
  [
    106.67942,
    10.816732
  ],
  [
    106.67875,
    10.816721
  ],
  [
    106.678759,
    10.817067
  ],
  [
    106.678766,
    10.817253
  ],
  [
    106.678771,
    10.81738
  ],
  [
    106.67879,
    10.818201
  ],
  [
    106.678793,
    10.818498
  ],
  [
    106.678797,
    10.81876
  ]
        ],
        "type": "LineString"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "B·ªánh Vi·ªán Qu√¢n Y 175",
        "address": "786 Nguy·ªÖn Ki·ªám, Ph∆∞·ªùng 3, Qu·∫≠n G√≤ V·∫•p, TP.HCM",
        "type": "B·ªánh vi·ªán qu√¢n ƒë·ªôi",
        "established": "1975",
        "area": "Khu v·ª±c y t·∫ø qu√¢n s·ª±"
      },
      "geometry": {
        "type": "Polygon",
        "symbol": {
          "type": "simple-fill",
          "color": [227, 139, 79, 0.4],
          "outline": {
            "color": [255, 255, 255],
            "width": 1
          }
        },
        "coordinates": [
          [
            [106.68050000000000, 10.818500000000000],
            [106.68050000000000, 10.819000000000000],
            [106.68100000000000, 10.819000000000000],
            [106.68100000000000, 10.818500000000000],
            [106.68050000000000, 10.818500000000000]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Trung t√¢m B·ªánh Vi·ªán Qu√¢n Y 175",
        "type": "ƒêi·ªÉm trung t√¢m",
        "description": "V·ªã tr√≠ trung t√¢m c·ªßa khu v·ª±c B·ªánh Vi·ªán Qu√¢n Y 175"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [106.68075000000000, 10.818750000000000]
      }
    }

  ]
};
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/Graphic",
      "esri/layers/GraphicsLayer"
    ], function(Map, MapView, Graphic, GraphicsLayer) {

		var map = new Map({
		basemap: "topo-vector"
		});
		 map.on("load", function(){
          map.graphics.enableMouseEvents();
        });

		var view = new MapView({
		container: "viewDiv",
		map: map,
		center: [106.6808, 10.8188],
		zoom: 15,
          highlightOptions: {
            color: "blue"
          }
		});
		var graphicsLayer = new GraphicsLayer();

		var lineSymbol = {
			type: "simple-line",
			color: [255, 87, 34],
			width: 3,
			style: "solid"
		};

		var polygonSymbol = {
			type: "simple-fill",
			color: [33, 150, 243, 0.6],
			outline: {
				color: [21, 101, 192],
				width: 2
			}
		};

		var pointSymbol = {
			type: "picture-marker",
			url: "https://cdn-icons-png.flaticon.com/128/619/619155.png",
			width: "56px",
			height: "56px"
		};

		jsondata.features.forEach(function(feature) {
			var geometry;
			var symbol;
			var popupTemplate;

			if (feature.geometry.type === "LineString") {
				geometry = {
					type: "polyline",
					paths: [feature.geometry.coordinates]
				};
				symbol = lineSymbol;
				popupTemplate = {
					title: feature.properties.name,
					content: "<b>M√¥ t·∫£:</b> {description}<br/><b>Lo·∫°i:</b> ƒê∆∞·ªùng ranh gi·ªõi"
				};

				var lineGraphic = new Graphic({
					geometry: geometry,
					symbol: symbol,
					attributes: feature.properties,
					popupTemplate: popupTemplate
				});
				graphicsLayer.add(lineGraphic);

				var polygonGeometry = {
					type: "polygon",
					rings: [feature.geometry.coordinates]
				};

				var polygonFill = {
					type: "simple-fill",
					color: [255, 193, 7, 0.4],
					outline: {
						color: [255, 152, 0],
						width: 2
					}
				};

				var polygonGraphic = new Graphic({
					geometry: polygonGeometry,
					symbol: polygonFill,
					attributes: { name: feature.properties.name + " (fill)" },
					popupTemplate: {
						title: feature.properties.name,
						content: "ƒê√¢y l√† v√πng ƒë∆∞·ª£c fill t·ª´ ƒë∆∞·ªùng ranh gi·ªõi."
					}
				});

				graphicsLayer.add(polygonGraphic);

				return;
			} else if (feature.geometry.type === "Polygon") {
				geometry = {
					type: "polygon",
					rings: feature.geometry.coordinates
				};
				symbol = polygonSymbol;
				popupTemplate = {
					title: feature.properties.name,
					content: `
						<div style="font-family: Arial, sans-serif;">
							<p><b>üìç ƒê·ªãa ch·ªâ:</b> {address}</p>
							<p><b>üèõÔ∏è Lo·∫°i:</b> {type}</p>
							<p><b>üìÖ Th√†nh l·∫≠p:</b> {established}</p>
							<p><b>üó∫Ô∏è Khu v·ª±c:</b> {area}</p>
							<p><b>‚ÑπÔ∏è M√¥ t·∫£:</b> Tr·ª• s·ªü ch√≠nh c·ªßa ch√≠nh quy·ªÅn th√†nh ph·ªë</p>
						</div>
					`
				};
			} else if (feature.geometry.type === "Point") {
				geometry = {
					type: "point",
					longitude: feature.geometry.coordinates[0],
					latitude: feature.geometry.coordinates[1]
				};
				symbol = pointSymbol;
				popupTemplate = {
					title: feature.properties.name,
					content: `
						<div style="font-family: Arial, sans-serif; text-align: center;">
							<p><b>üìç {type}</b></p>
							<p>{description}</p>
							<p style="color: #1976D2;"><b>T·ªça ƒë·ªô:</b><br/>
							Kinh ƒë·ªô: ${feature.geometry.coordinates[0].toFixed(6)}<br/>
							Vƒ© ƒë·ªô: ${feature.geometry.coordinates[1].toFixed(6)}</p>
						</div>
					`
				};
			}

			var graphic = new Graphic({
				geometry: geometry,
				symbol: symbol,
				attributes: feature.properties,
				popupTemplate: popupTemplate
			});
			graphicsLayer.add(graphic);
		});

// Khai b√°o m·∫£ng ƒë·ªÉ l∆∞u tr·ªØ c√°c t·ªça ƒë·ªô ƒë∆∞·ª£c click
            var clickedCoordinates = [];
            var clickedGraphics = []; // ƒê·ªÉ l∆∞u tr·ªØ c√°c graphic ƒëi·ªÉm ƒë√£ click

            // --- Th√™m layer ri√™ng cho c√°c ƒëi·ªÉm click v√†o b·∫£n ƒë·ªì ---
            // ƒê·∫£m b·∫£o r·∫±ng bi·∫øn 'map' ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o tr∆∞·ªõc khi g·ªçi d√≤ng n√†y
            // N·∫øu b·∫°n ƒë√£ c√≥ map.add(graphicsLayer); th√¨ h√£y th√™m d√≤ng n√†y sau ƒë√≥.
            var clickGraphicsLayer; // Khai b√°o bi·∫øn layer ·ªü ƒë√¢y
            require([
                "esri/Graphic",
                "esri/layers/GraphicsLayer"
            ], function (Graphic, GraphicsLayer) {
                clickGraphicsLayer = new GraphicsLayer(); // Kh·ªüi t·∫°o GraphicsLayer
                map.add(clickGraphicsLayer); // Th√™m layer ri√™ng cho c√°c ƒëi·ªÉm click v√†o b·∫£n ƒë·ªì

                // --- X·ª≠ l√Ω s·ª± ki·ªán click tr√™n b·∫£n ƒë·ªì ---
                // ƒê·∫£m b·∫£o r·∫±ng bi·∫øn 'view' ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o tr∆∞·ªõc khi g·ªçi d√≤ng n√†y
                view.on("click", function (event) {
                    var latitude = parseFloat(event.mapPoint.latitude.toFixed(6));
                    var longitude = parseFloat(event.mapPoint.longitude.toFixed(6));
                    var newCoordinate = [longitude, latitude]; // ƒê·ªãnh d·∫°ng [kinh ƒë·ªô, vƒ© ƒë·ªô]

                    clickedCoordinates.push(newCoordinate); // Th√™m t·ªça ƒë·ªô v√†o m·∫£ng

                    // T·∫°o graphic cho ƒëi·ªÉm m·ªõi click
                    var pointGraphic = new Graphic({
                        geometry: {
                            type: "point",
                            longitude: longitude,
                            latitude: latitude
                        },
                        symbol: {
                            type: "simple-marker",
                            color: [0, 150, 136], // M√†u xanh ng·ªçc
                            size: 8,
                            outline: {
                                color: [255, 255, 255],
                                width: 1
                            }
                        },
                        popupTemplate: {
                            title: "ƒêi·ªÉm ƒë√£ ch·ªçn",
                            content: `Vƒ© ƒë·ªô: ${latitude.toFixed(6)}<br>Kinh ƒë·ªô: ${longitude.toFixed(6)}`
                        }
                    });
                    clickGraphicsLayer.add(pointGraphic); // Th√™m v√†o layer ri√™ng
                    clickedGraphics.push(pointGraphic); // L∆∞u graphic ƒë·ªÉ c√≥ th·ªÉ x√≥a sau

                    updateCoordinateOutput(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã JSON
                });

                // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t n·ªôi dung hi·ªÉn th·ªã JSON (v√† log ra console)
                function updateCoordinateOutput() {
                    var jsonString = JSON.stringify(clickedCoordinates, null, 2); // ƒê·ªãnh d·∫°ng JSON ƒë·∫πp h∆°n

                    // Log ra console
                    console.log("Current Coordinates (JSON):");
                    console.log(jsonString);

                    // C·∫≠p nh·∫≠t hi·ªÉn th·ªã tr√™n trang HTML (n·∫øu c√≥ div output)
                    var outputDiv = document.getElementById("coordinateOutput");
                    if (outputDiv) {
                        outputDiv.textContent = jsonString;
                    } else {
                        console.warn("Element with id 'coordinateOutput' not found. Coordinates will only be logged to console.");
                    }
                }

                // --- N√∫t ƒë·ªÉ x√≥a t·∫•t c·∫£ c√°c ƒëi·ªÉm ƒë√£ click v√† m·∫£ng t·ªça ƒë·ªô ---
                var clearButton = document.getElementById("clearButton");
                if (clearButton) { // Ki·ªÉm tra xem n√∫t c√≥ t·ªìn t·∫°i kh√¥ng
                    clearButton.addEventListener("click", function () {
                        clickedCoordinates = []; // X√≥a m·∫£ng t·ªça ƒë·ªô
                        clickGraphicsLayer.removeAll(); // X√≥a t·∫•t c·∫£ graphic tr√™n layer click
                        clickedGraphics = []; // X√≥a m·∫£ng graphic ƒë√£ l∆∞u
                        updateCoordinateOutput(); // C·∫≠p nh·∫≠t l·∫°i hi·ªÉn th·ªã (s·∫Ω log m·∫£ng r·ªóng)
                    });
                } else {
                    console.warn("Element with id 'clearButton' not found. Clear functionality will not be available.");
                }
            });

		map.add(graphicsLayer);


    });
  </script>
</head>
<body>
  <div id="viewDiv"></div>
</body>
</html>
